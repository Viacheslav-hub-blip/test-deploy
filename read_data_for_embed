import os
import re
from datetime import datetime, timedelta

FOLDER_1 = "folder_main"    # Папка 1 (где добавляем заголовок)
FOLDER_2 = "folder_other"   # Папка 2 (с чем сопоставляем)
YEAR = 2024

def get_header_str(year, week):
    # Генерация строки с датами
    start_date = datetime.strptime(f'{year}-W{week}-1', "%G-W%V-%u")
    dates = [(start_date + timedelta(days=i)).strftime('%d.%m.%Y') for i in range(7)]
    return f"Отчет за {week}, содержит информацию за даты {', '.join(dates)}\n\n"

# 1. Читаем вторую папку в словарь: { '35': 'текст файла...' }
docs_map = {}
for filename in os.listdir(FOLDER_2):
    match = re.search(r'(3[0-9]|4[0-9])', filename)
    if match:
        with open(os.path.join(FOLDER_2, filename), 'r', encoding='utf-8') as f:
            docs_map[match.group(1)] = f.read()

# 2. Собираем итоговый список
result_data = []

for filename in os.listdir(FOLDER_1):
    match = re.search(r'(3[0-9]|4[0-9])', filename)
    
    # Если нашли цифру и для нее есть пара во второй папке
    if match and match.group(1) in docs_map:
        week_num = match.group(1)
        
        # Читаем файл из первой папки
        with open(os.path.join(FOLDER_1, filename), 'r', encoding='utf-8') as f:
            content_1 = f.read()
            
        # Формируем первый элемент (Заголовок + Текст)
        text_with_header = get_header_str(YEAR, week_num) + content_1
        
        # Достаем второй элемент (Текст из второй папки)
        content_2 = docs_map[week_num]
        
        # Добавляем tuple в список
        result_data.append((text_with_header, content_2))

# result_data теперь содержит список tuples
print(f"Сформировано пар: {len(result_data)}")
